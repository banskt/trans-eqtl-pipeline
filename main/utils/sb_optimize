#!/bin/bash

THISMETHOD="sboptim"
THISJOBDEPS="None"
EXPRESSIONFILE=${GX_TISSUE_FMT/\[PREPROC_STRING\]/${TEJAAS_PREPROC_STR}}

JOBSUBDIR_SBOPTIM="${JOBSUBDIR_DATA}/${THISMETHOD}"

SPECIFIC_JOBSUBDIR="${JOBSUBDIR_SBOPTIM}"
if [ ! -d ${SPECIFIC_JOBSUBDIR} ]; then mkdir -p ${SPECIFIC_JOBSUBDIR}; fi
SPECIFIC_OUTDIR="${OUTDIR_DATA}/${THISMETHOD}"
if [ ! -d ${SPECIFIC_OUTDIR} ]; then mkdir -p ${SPECIFIC_OUTDIR}; fi

OUTFILE_SBOPTIM="${SPECIFIC_OUTDIR}/${TSHORT}_sboptim.txt"
SBOPTIM_JOBNAME="${THISMETHOD}_${TSHORT}_${RANDSTRING}"

sed -e "s|_JOB_NAME|${SBOPTIM_JOBNAME}|g;
        s|_PYT_ENV_|${PYTHON36}|g;
        s|_SBOP_PY_|${SBOPT_PY}|g;
        s|_EXPR_FL_|${EXPRESSIONFILE}|g;
        s|_OUTF_SB_|${OUTFILE_SBOPTIM}|g;
       " ${MASTER_BSUBDIR}/sigbeta_optimizer.sbatch > ${SPECIFIC_JOBSUBDIR}/${SBOPTIM_JOBNAME}.sbatch

SBOPTIM_JOBID=$( submit_job ${SPECIFIC_JOBSUBDIR} ${SBOPTIM_JOBNAME} ${THISJOBDEPS} )
JOBDEPS=$( add_deps "${JOBDEPS}" ${SBOPTIM_JOBID} )
